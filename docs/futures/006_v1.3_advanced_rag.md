# Advanced RAG Features

> **Versão Target:** V1.3
> **Status:** ⏳ Pendente
> **Owner:** Unassigned
> **Estimativa:** 30h

---

## Descrição

Melhorias avançadas no sistema RAG (Retrieval Augmented Generation), incluindo re-ranking de resultados, metadata filtering avançado, e UI para upload de documentos da knowledge base.

---

## Passos de Implementação

### 1. Código

- [ ] **Re-ranking** (8h)
  - `src/rag/reranker.py` - Implementar cross-encoder reranker
  - Integrar com Cohere Rerank ou modelo local
  - Configurar threshold de relevância

- [ ] **Metadata Filtering** (6h)
  - `src/rag/filters.py` - Filtros por categoria, data, tags
  - Query builder para MongoDB Atlas Search
  - Suporte a filtros compostos (AND, OR)

- [ ] **Upload UI** (8h)
  - `src/api/documents_routes.py` - Upload endpoint
  - Parsing de PDF, DOCX, TXT
  - Chunking automático
  - Embedding generation em batch

### 2. Testes

- [ ] Unit tests para reranker (2h)
- [ ] Unit tests para filters (2h)
- [ ] Integration tests para upload flow (2h)

### 3. Documentação

- [ ] `docs/RAG_ADVANCED.md` - Guia técnico
- [ ] API docs para endpoints de documents

### 4. Infraestrutura

- [ ] S3 bucket para armazenamento de documentos
- [ ] Background jobs para processing (Celery ou similar)

---

## Re-ranking Pipeline

```
Query → Semantic Search (top 20) → Reranker → Top 5 relevantes → LLM
```

---

## Metadata Schema

```javascript
{
  content: String,
  embedding: [Float],
  metadata: {
    source: String,        // filename
    category: String,      // "faq", "policy", "product"
    tags: [String],
    created_at: DateTime,
    company_id: ObjectId
  }
}
```

---

## Dependências

- V1.0 completo
- Vector search configurado (MongoDB Atlas)

---

## Referências

- [Cohere Rerank](https://cohere.com/rerank)
- [MongoDB Atlas Vector Search](https://www.mongodb.com/docs/atlas/atlas-vector-search/)
