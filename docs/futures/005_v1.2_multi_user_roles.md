# Multi-User Support com Roles

> **Versão Target:** V1.2
> **Status:** ⏳ Pendente
> **Owner:** Unassigned
> **Estimativa:** 25h

---

## Descrição

Implementação de sistema multi-user com controle de acesso baseado em roles (RBAC), permitindo múltiplos agentes humanos com diferentes níveis de permissão no dashboard.

---

## Passos de Implementação

### 1. Código

- [ ] `src/models/user.py` - Modelos de User e Role (2h)
- [ ] `src/api/users_routes.py` - CRUD de usuários (4h)
- [ ] `src/api/auth_routes.py` - Login, logout, refresh token (3h)
- [ ] `src/utils/permissions.py` - Decorators de permissão (2h)
- [ ] `src/middleware/auth_middleware.py` - Middleware JWT (2h)
- [ ] Atualizar endpoints existentes com checks de permissão

### 2. Testes

- [ ] `tests/unit/test_users.py` - Unit tests (2h)
- [ ] `tests/unit/test_permissions.py` - Permission tests (2h)
- [ ] `tests/integration/test_auth_flow.py` - E2E auth (2h)

### 3. Documentação

- [ ] `docs/USER_MANAGEMENT.md` - Guia de gerenciamento
- [ ] API docs para endpoints de auth/users

### 4. Infraestrutura

- [ ] MongoDB indexes para users collection
- [ ] Password hashing (bcrypt)
- [ ] JWT secret rotation strategy

---

## Roles Propostos

| Role | Descrição | Permissões |
|------|-----------|------------|
| `admin` | Administrador | Tudo |
| `supervisor` | Supervisor de equipe | Ver todos tickets, métricas, gerenciar agentes |
| `agent` | Agente de suporte | Ver/responder tickets atribuídos |
| `viewer` | Visualizador | Apenas leitura de métricas |

---

## Schema MongoDB

```javascript
// users collection
{
  _id: ObjectId,
  email: String,           // unique
  password_hash: String,
  name: String,
  role: "admin" | "supervisor" | "agent" | "viewer",
  company_id: ObjectId,    // multi-tenancy
  is_active: Boolean,
  created_at: DateTime,
  last_login: DateTime
}
```

---

## Dependências

- JWT authentication básico (já implementado parcialmente)
- Dashboard React (para UI de gerenciamento)

---

## Referências

- [FastAPI Security](https://fastapi.tiangolo.com/tutorial/security/)
- [bcrypt](https://pypi.org/project/bcrypt/)
